"""
OpenAI Function Calling Definitions

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∫–æ—Ç–æ—Ä—ã–µ AI –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π.
–ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–µ—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∞ —á—Ç–æ–±—ã AI –ø–æ–Ω–∏–º–∞–ª –∫–æ–≥–¥–∞ –µ—ë –≤—ã–∑—ã–≤–∞—Ç—å.

–ü—Ä–∏–Ω—Ü–∏–ø: Single Responsibility - –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç –æ–¥–Ω—É –≤–µ—â—å.
"""
import logging
from typing import List, Dict, Tuple

logger = logging.getLogger(__name__)


def get_function_definitions() -> List[Dict]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è OpenAI Function Calling
    
    –§–æ—Ä–º–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç OpenAI API specification:
    https://platform.openai.com/docs/guides/function-calling
    
    Returns:
        List[Dict]: –°–ø–∏—Å–æ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–π
    """
    return [
        {
            "type": "function",
            "function": {
                "name": "create_bitrix_deal",
                "description": (
                    "üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û! üî¥ –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ –≤ –ë–∏—Ç—Ä–∏–∫—Å24 CRM. "
                    "‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑—ã–≤–∞–π –ù–ï–ú–ï–î–õ–ï–ù–ù–û, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —É–∫–∞–∑–∞–ª —Ç–µ–ª–µ—Ñ–æ–Ω! ‚ö†Ô∏è "
                    "–ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ù–ï –¥–ª—è –æ—Ñ–∏—Å–æ–≤/–∫–æ–º–ø–∞–Ω–∏–π/—é—Ä–ª–∏—Ü). "
                    "–ó–ê–ü–†–ï–©–ï–ù–û –≥–æ–≤–æ—Ä–∏—Ç—å '–æ—Ñ–æ—Ä–º–ª—é –∑–∞—è–≤–∫—É' –±–µ–∑ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏! "
                    "–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ = –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ —Å–∏—Å—Ç–µ–º–µ."
                ),
                "parameters": {
                    "type": "object",
                    "properties": {
                        "phone": {
                            "type": "string",
                            "description": "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"
                        },
                        "city": {
                            "type": "string",
                            "description": "–ì–æ—Ä–æ–¥ –≥–¥–µ –Ω—É–∂–Ω—ã –≥—Ä—É–∑—á–∏–∫–∏"
                        },
                        "hours": {
                            "type": "integer",
                            "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã"
                        },
                        "people": {
                            "type": "integer",
                            "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑—á–∏–∫–æ–≤"
                        },
                        "work_type": {
                            "type": "string",
                            "description": "–¢–∏–ø —Ä–∞–±–æ—Ç—ã (–ø–æ–≥—Ä—É–∑–∫–∞, –ø–µ—Ä–µ–µ–∑–¥, –≤—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞ –∏ —Ç.–¥.)"
                        },
                        "summary": {
                            "type": "string",
                            "description": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
                        }
                    },
                    "required": ["phone"]
                }
            }
        },
        {
            "type": "function",
            "function": {
                "name": "create_bitrix_deal_legal",
                "description": (
                    "üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û! üî¥ –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ –≤ –ë–∏—Ç—Ä–∏–∫—Å24. "
                    "‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑—ã–≤–∞–π –ù–ï–ú–ï–î–õ–ï–ù–ù–û, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç-—é—Ä–ª–∏—Ü–æ —É–∫–∞–∑–∞–ª —Ç–µ–ª–µ—Ñ–æ–Ω! ‚ö†Ô∏è "
                    "–ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —É–ø–æ–º–∏–Ω–∞–µ—Ç: –æ—Ñ–∏—Å, –∫–æ–º–ø–∞–Ω–∏—è, —é—Ä.–ª–∏—Ü–æ, –æ–ø–ª–∞—Ç–∞ –ø–æ —Å—á–µ—Ç—É, "
                    "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ, –¥–æ–≥–æ–≤–æ—Ä, –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. "
                    "–ó–ê–ü–†–ï–©–ï–ù–û –≥–æ–≤–æ—Ä–∏—Ç—å '–æ—Ñ–æ—Ä–º–ª—é –∑–∞—è–≤–∫—É' –±–µ–∑ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏! "
                    "–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ = –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ —Å–∏—Å—Ç–µ–º–µ."
                ),
                "parameters": {
                    "type": "object",
                    "properties": {
                        "phone": {
                            "type": "string",
                            "description": "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è –∫–æ–º–ø–∞–Ω–∏–∏"
                        },
                        "company_name": {
                            "type": "string",
                            "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)"
                        },
                        "city": {
                            "type": "string",
                            "description": "–ì–æ—Ä–æ–¥ –≥–¥–µ –Ω—É–∂–Ω—ã —É—Å–ª—É–≥–∏"
                        },
                        "hours": {
                            "type": "integer",
                            "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã"
                        },
                        "people": {
                            "type": "integer",
                            "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑—á–∏–∫–æ–≤"
                        },
                        "work_type": {
                            "type": "string",
                            "description": "–¢–∏–ø —Ä–∞–±–æ—Ç—ã"
                        },
                        "summary": {
                            "type": "string",
                            "description": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π (—Ç–µ—Ö.–∑–∞–¥–∞–Ω–∏–µ, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ç.–¥.)"
                        }
                    },
                    "required": ["phone"]
                }
            }
        },
        {
            "type": "function",
            "function": {
                "name": "get_city_pricing",
                "description": (
                    "–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–æ–ª—É—á–∏—Ç—å —Ç–æ—á–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏–∑ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞. "
                    "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑—ã–≤–∞–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –°–†–ê–ó–£ –∫–∞–∫ —Ç–æ–ª—å–∫–æ —É–∑–Ω–∞–ª –≥–æ—Ä–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞! "
                    "–§—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω–µ—Ç —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É –∑–∞ —á–∞—Å, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —á–∞—Å—ã –∏ –¥—Ä—É–≥–∏–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞. "
                    "–ë–ï–ó —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ç—ã –ù–ï –ú–û–ñ–ï–®–¨ –Ω–∞–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–µ–Ω—É!"
                ),
                "parameters": {
                    "type": "object",
                    "properties": {
                        "city": {
                            "type": "string",
                            "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–π—Å–∞"
                        }
                    },
                    "required": ["city"]
                }
            }
        },
        {
            "type": "function",
            "function": {
                "name": "calculate_price_estimate",
                "description": (
                    "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –≥—Ä—É–∑—á–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞. "
                    "–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ —Ü–µ–Ω—É –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –≥–æ—Ä–æ–¥, —á–∞—Å—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π."
                ),
                "parameters": {
                    "type": "object",
                    "properties": {
                        "city": {
                            "type": "string",
                            "description": "–ì–æ—Ä–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞"
                        },
                        "hours": {
                            "type": "integer",
                            "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã"
                        },
                        "people": {
                            "type": "integer",
                            "description": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑—á–∏–∫–æ–≤"
                        }
                    },
                    "required": ["city", "hours", "people"]
                }
            }
        }
    ]


def get_function_by_name(function_name: str) -> Dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –∏–º–µ–Ω–∏
    
    Args:
        function_name: –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏
        
    Returns:
        Dict: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ None
    """
    definitions = get_function_definitions()
    for func_def in definitions:
        if func_def["function"]["name"] == function_name:
            return func_def["function"]
    
    logger.warning(f"–§—É–Ω–∫—Ü–∏—è {function_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö")
    return None


def validate_function_arguments(function_name: str, arguments: Dict) -> Tuple[bool, str]:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
    
    Args:
        function_name: –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏
        arguments: –°–ª–æ–≤–∞—Ä—å —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
        
    Returns:
        tuple[bool, str]: (–≤–∞–ª–∏–¥–Ω—ã –ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)
    """
    func_def = get_function_by_name(function_name)
    if not func_def:
        return False, f"–§—É–Ω–∫—Ü–∏—è {function_name} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    
    required_params = func_def["parameters"].get("required", [])
    
    for param in required_params:
        if param not in arguments:
            return False, f"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: {param}"
    
    return True, ""

